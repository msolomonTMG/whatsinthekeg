<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Whatsinthekeg</title>
    <!-- Favicon -->
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="icon" href="/img/favicon.ico" type="image/x-icon">

    <!-- Bootstrap Core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="css/stylish-portfolio.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
    <link href="http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,300italic,400italic,700italic" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body>

    <!-- desktop nav -->
    <nav class="navbar navbar-default navbar-fixed-top hidden-sm hidden-xs">
      <div class="container">
        <div class="navbar-header">
          <a class="navbar-brand" href="/">What's in the Keg?</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
          </ul>
          <ul class="nav navbar-nav navbar-right">
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-caret-down"></i></a>
              <ul class="dropdown-menu" role="menu">
                <li><a href="#"><i class="fa fa-heart"></i> Favorites</a></li>
                <li><a href="/history.html"><i class="fa fa-history"></i> History</a></li>
                <li class="divider"></li>
                <li class="dropdown-header">About</li>
                <li><a href="#"><i class="fa fa-question-circle"></i> What is this</a></li>
              </ul>
            </li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <!-- tablet nav -->
    <nav class="navbar navbar-default navbar-fixed-top visible-sm hidden-xs">
      <div class="container">
        <div class="navbar-header">
            <a class="navbar-brand" href="/">What's in the Keg?</a>
              <ul class="nav navbar-nav list-inline">
                <li><a href="#"><i class="fa fa-heart"></i> Favorites</a></li>
                <li><a href="/history.html"><i class="fa fa-history"></i> History</a></li>
                <li><a href="#"><i class="fa fa-question-circle"></i> What is this</a></li>
              </ul>
        </div>
      </div>
    </nav>

    <!-- phone nav -->
    <nav class="navbar navbar-default navbar-fixed-top hidden-sm visible-xs">
      <div class="container">
        <div class="row">
            <a class="navbar-brand" href="/">What's in the Keg?</a>
            <div class="pull-right">
                <a class="navbar-brand" href="#"><i class="fa fa-heart"></i></a>
                <a class="navbar-brand" href="/history.html"><i class="fa fa-history"></i></a>
                <a class="navbar-brand" href="#"><i class="fa fa-question-circle"></i></a>
            </div>
        </div>
      </div>
    </nav>

    <!-- Header -->
    <header id="top" class="header">
        <div class="container" style="margin-top:30px;">
        <div class="text-vertical-center">
            <div class="row">
                <div class="col-md-6">
                    <div class="panel panel-default">
                        <div class="panel-heading">Tech</div>
                        <div class="panel-body">

                        <!-- Update Success Alert -->
                            <div class="row">
                                <div clas="container">
                                    <div class="col-md-12">
                                        <div id="techBeerUpdated" class="alert alert-success" hidden="hidden" role="alert">
                                            <button type="button" class="close" data-hide="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                            <strong>Success!</strong> Tech's beer was updated!
                                        </div>
                                    </div>
                                </div>
                            </div>
                        <!-- End success alert -->
                    
                        <!-- Update Failed Alert -->
                            <div class="row">
                                <div clas="container">
                                    <div class="col-md-12">
                                        <div id="techBeerUpdateFailed" class="alert alert-danger" hidden="hidden" role="alert">
                                            <button type="button" class="close" data-hide="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                            <strong>Shit!</strong> Something went wrong, couldn't update tech's beer!
                                        </div>
                                    </div>
                                </div>
                            </div>
                        <!-- End success alert -->

                            <form class="form-horizontal">
                                <div class="form-group">
                                    <div class="col-xs-12">
                                        <select class="form-control" id="techBeerOptions">
                                        </select>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="panel-footer">
                            <div class="row">
                                <button type="button" class="btn btn-primary" id="updateTechBeer">New Beer for Tech!</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="panel panel-default">
                        <div class="panel-heading">Edit</div>
                        <div class="panel-body">

                        <!-- Update Success Alert -->
                            <div class="row">
                                <div clas="container">
                                    <div class="col-md-12">
                                        <div id="editBeerUpdated" class="alert alert-success" hidden="hidden" role="alert">
                                            <button type="button" class="close" data-hide="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                            <strong>Success!</strong> Tech's beer was updated!
                                        </div>
                                    </div>
                                </div>
                            </div>
                        <!-- End success alert -->
                    
                        <!-- Update Failed Alert -->
                            <div class="row">
                                <div clas="container">
                                    <div class="col-md-12">
                                        <div id="editBeerUpdateFailed" class="alert alert-danger" hidden="hidden" role="alert">
                                            <button type="button" class="close" data-hide="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                            <strong>Shit!</strong> Something went wrong, couldn't update tech's beer!
                                        </div>
                                    </div>
                                </div>
                            </div>
                        <!-- End success alert -->

                            <form class="form-horizontal">
                                <div class="form-group">
                                    <div class="col-xs-12">
                                        <select class="form-control" id="editBeerOptions">
                                        </select>
                                    </div>
                                </div>
                            </form>
                            </form>
                        </div>
                        <div class="panel-footer">
                            <div class="row">
                                <button type="button" class="btn btn-primary" id="updateEditBeer">New Beer for Edit!</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-8 col-md-offset-2">
                    <div class="panel panel-default">
                        <div class="panel-heading">Add New Beer</div>
                        <div class="panel-body">


                        <!-- Update Success Alert -->
                            <div class="row">
                                <div clas="container">
                                    <div class="col-md-12">
                                        <div id="newBeerAdded" class="alert alert-success" hidden="hidden" role="alert">
                                            <button type="button" class="close" data-hide="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                            <strong>Success!</strong> New beer added!
                                        </div>
                                    </div>
                                </div>
                            </div>
                        <!-- End success alert -->
                    
                        <!-- Update Failed Alert -->
                            <div class="row">
                                <div clas="container">
                                    <div class="col-md-12">
                                        <div id="newBeerFailed" class="alert alert-danger" hidden="hidden" role="alert">
                                            <button type="button" class="close" data-hide="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                            <strong>Shit!</strong> Something went wrong, couldn't save that brew!
                                        </div>
                                    </div>
                                </div>
                            </div>
                        <!-- End success alert -->

                            <form class="form-horizontal">
                                <div class="form-group">
                                    <div class="col-xs-6">
                                        <div class="input-group">
                                            <span class="input-group-addon"><i class="fa fa-beer"></i></span>
                                            <input type="text" class="form-control input-lg" id="newBeerName" placeholder="Beer Name">
                                        </div>
                                    </div>
                                    <div class="col-xs-6">
                                        <div class="input-group">
                                            <span class="input-group-addon"><i class="fa fa-camera"></i></span>
                                            <input type="text" class="form-control input-lg" id="newBeerImage" placeholder="Image URL">
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="col-xs-12">
                                        <div class="input-group">
                                            <span class="input-group-addon"><i class="fa fa-globe"></i></span>
                                            <input type="text" class="form-control input-lg" id="newBeerWebsite" placeholder="Beer Website">
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="panel-footer">
                            <div class="row">
                                <button type="button" class="btn btn-success" id="createNewBeer">Add New Beer!</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-8 col-md-offset-2">
                    <div class="panel panel-default">
                        <div class="panel-heading">Delete a Beer</div>
                        <div class="panel-body">

                        <!-- Update Success Alert -->
                            <div class="row">
                                <div clas="container">
                                    <div class="col-md-12">
                                        <div id="deleteBeerConfirmed" class="alert alert-success" hidden="hidden" role="alert">
                                            <button type="button" class="close" data-hide="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                            <strong>Good riddance!</strong> Successfully deleted that beer!
                                        </div>
                                    </div>
                                </div>
                            </div>
                        <!-- End success alert -->
                    
                        <!-- Update Failed Alert -->
                            <div class="row">
                                <div clas="container">
                                    <div class="col-md-12">
                                        <div id="deleteBeerFailed" class="alert alert-danger" hidden="hidden" role="alert">
                                            <button type="button" class="close" data-hide="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                            <strong>Shit!</strong> Something went wrong, couldn't delete that brew!
                                        </div>
                                    </div>
                                </div>
                            </div>
                        <!-- End success alert -->

                            <form class="form-horizontal">
                                <div class="form-group">
                                    <div class="col-xs-12">
                                        <select class="form-control" id="deleteBeerOptions">
                                        </select>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="panel-footer">
                            <div class="row">
                                <button type="button" class="btn btn-danger" id="deleteBeerWarning" data-toggle="modal" data-target="#deleteWarningModal">Delete a Beer</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


        </div>
        </div>
    </header>

    <!-- Delete Modal -->
    <div class="modal fade" id="deleteWarningModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel">Are You Sure?</h4>
          </div>
          <div class="modal-body">
            <strong>Dude, chill!</strong> Deleting this beer will delete everything about it including likes, comments, picture links, ever-ree-thang... Are you sure you want to delete it?
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Nevermind</button>
            <button type="button" class="btn btn-danger" data-dismiss="modal" id="deleteBeer"><i class="fa fa-trash"></i> Delete</button>
          </div>
        </div>
      </div>
    </div>


    <!-- jQuery -->
    <script src="js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="js/bootstrap.min.js"></script>

    <!-- Datepicker -->
    <script src="js/whatsinthekeg.js"></script>

    <!-- Custom Theme JavaScript -->
    <script>

    var beers;
    initializePage();

    function initializePage(){
        getAllBeers();
        powerAllDropdowns();
    }

    //Get all beers
    function getAllBeers(){
        $.ajax({
            url: window.apiURL,
            type: 'get',
            async: false,
            success: function(data) {
                beers = data;
            } 
        });
    }

    //Power dropdowns
    function powerAllDropdowns(){
        powerOptions(techBeerOptions);
        powerOptions(editBeerOptions);
        powerOptions(deleteBeerOptions);
    }

    function powerOptions(dropdown){
        clearCurrentOptions(dropdown);
        var i = 0;
        while(i < beers.length){
            var $option = $("<option>", {id: beers[i].id});
            $option.html(beers[i].name);
            addOptionTo(dropdown, $option);
            
            if (dropdown != deleteBeerOptions){
                checkIfCurrent(dropdown, beers[i]);
            }

            i++;
        }
    }
    //Function for clearing the current options of a dropdown
    function clearCurrentOptions(dropdown){
        while (dropdown.firstChild) {
            dropdown.removeChild(dropdown.firstChild);
        }
    }
    //Function for adding onto dropdown
    function addOptionTo(location, option){
        $(location).append(option);
        return false;
    }
    //Function for selecting current option by default
    function checkIfCurrent(dropdown, beer){
        if (dropdown == techBeerOptions){
            if(beer.currentTechBeer == "true"){
                $(dropdown).val(beer.name);
            }
        }
        if (dropdown == editBeerOptions){
            if(beer.currentEditBeer == "true"){
                $(dropdown).val(beer.name);
            }
        }
    }


    //Create new beers
    $('#createNewBeer').click(function(){
        var name = $('#newBeerName').val();
        var imgurl = $('#newBeerImage').val();
        var website = $('#newBeerWebsite').val();
        $.ajax({
            url: window.apiURL+'/create/?name='+name+'&imgurl='+imgurl+'&website='+website,
            type: 'get',
            async: false,
            success: function(data) {
                console.log(data);
                $('#newBeerAdded').fadeIn();
                $('#newBeerName').val('');
                $('#newBeerImage').val('');
                $('#newBeerWebsite').val('');
                initializePage();
            },
            error: function(data){
                $('#newBeerFailed').fadeIn();
                $('#newBeerName').val('');
                $('#newBeerImage').val('');
                $('#newBeerWebsite').val('');
            } 
        });    
    });

    //Delete beers
    $('#deleteBeer').click(function(){
        var beerID = $('#deleteBeerOptions').children(":selected").attr("id");
        $.ajax({
            url: window.apiURL+'/destroy/'+beerID,
            type: 'get',
            async: false,
            success: function(data) {
                $('#deleteBeerConfirmed').fadeIn();
                initializePage();
            },
            error: function(data){
                $('#deleteBeerFailed').fadeIn();
            } 
        });    
    });

    //Update Beers!
    $('#updateTechBeer').click(function(){
        removeCurrentBeer("tech");
        var beerID = $('#techBeerOptions').children(":selected").attr("id");
        $.ajax({
            url: window.apiURL+'/update/'+beerID+'?currentTechBeer=true',
            type: 'get',
            async: false,
            success: function(data) {
                $('#techBeerUpdated').fadeIn();
            },
            error: function(data) {
                $('#techBeerUpdateFailed').fadeIn();
                console.log(data);
            }
        });
    });
    $('#updateEditBeer').click(function(){
        removeCurrentBeer("edit");
        var beerID = $('#editBeerOptions').children(":selected").attr("id");
        $.ajax({
            url: window.apiURL+'/update/'+beerID+'?currentEditBeer=true',
            type: 'get',
            async: false,
            success: function(data) {
                $('#editBeerUpdated').fadeIn();
            },
            error: function(data) {
                $('#editBeerUpdateFailed').fadeIn();
            }
        });
    });

    //Remove the current beer to make way for the new one to get set
    function removeCurrentBeer(floor){
        var i = 0;
        while(i < beers.length){
            if (floor == "tech" && beers[i].currentTechBeer == "true"){
                setCurrentToFalse(floor, beers[i].id);
            }
            else if(floor == "edit" && beers[i].currentEditBeer == "true"){
                setCurrentToFalse(floor, beers[i].id);
            }
            i++;
        }
        function setCurrentToFalse(floor, currentBeerID){
            var updateURL = "";

            if (floor == "tech"){
                updateURL = window.apiURL+'/update/'+currentBeerID+'?currentTechBeer=false';
            }

            else if (floor == "edit"){
                updateURL = window.apiURL+'/update/'+currentBeerID+'?currentEditBeer=false';
            }

            $.ajax({
                url: updateURL,
                type: 'get',
                async: false,
                success: function(data) {
                    setLastOnTapForPreviousBeer(data.id, data.updatedAt);
                } 
            });
        }
        function setLastOnTapForPreviousBeer(previousBeerID, dateRemovedFromKeg){
            $.ajax({
                url: window.apiURL+'/update/'+previousBeerID+'?lastOnTap='+dateRemovedFromKeg,
                type: 'get',
                async: false,
                success: function(data) {
                    console.log(data);
                } 
            });
        }
    }


    //sorts in alphabetical order
    function compare(a,b) {
      if (a.name < b.name)
         return -1;
      if (a.name > b.name)
        return 1;
      return 0;
    }

    // Closes the sidebar menu
    $("#menu-close").click(function(e) {
        e.preventDefault();
        $("#sidebar-wrapper").toggleClass("active");
    });

    // Opens the sidebar menu
    $("#menu-toggle").click(function(e) {
        e.preventDefault();
        $("#sidebar-wrapper").toggleClass("active");
    });

    // Scrolls to the selected menu item on the page
    $(function() {
        $('a[href*=#]:not([href=#])').click(function() {
            if (location.pathname.replace(/^\//, '') == this.pathname.replace(/^\//, '') || location.hostname == this.hostname) {

                var target = $(this.hash);
                target = target.length ? target : $('[name=' + this.hash.slice(1) + ']');
                if (target.length) {
                    $('html,body').animate({
                        scrollTop: target.offset().top
                    }, 1000);
                    return false;
                }
            }
        });
    });

    //Hiding alerts
    $(function(){
        $("[data-hide]").on("click", function(){
            $(this).closest("." + $(this).attr("data-hide")).hide();
        });
    });
    </script>

</body>

</html>
